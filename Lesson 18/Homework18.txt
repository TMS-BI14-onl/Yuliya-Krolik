--1.
SELECT t1.MANAGER_ID, t2.FIRST_NAME, t2.LAST_NAME, COUNT(t1.EMPLOYEE_ID) as cnt_empl
FROM EMPLOYEES t1 
JOIN EMPLOYEES t2 ON t1.MANAGER_ID = t2.MANAGER_ID
GROUP BY t1.MANAGER_ID, t2.FIRST_NAME, t2.LAST_NAME
HAVING cnt_empl > 6

--2.
SELECT DEPARTMENT_NAME,
	MIN(SALARY*(100-COMMISSION_PCT)/100)  AS min_salary,
	MAX(SALARY*(100-COMMISSION_PCT)/100)  AS max_salary
FROM EMPLOYEES e
JOIN DEPARTMENTS d
ON e.DEPARTMENT_ID = d.DEPARTMENT_ID
GROUP BY DEPARTMENT_NAME

--3.
SELECT REGION_NAME
FROM
(SELECT TOP 1 WITH TIES REGION_NAME, COUNT(EMPLOYEE_ID) AS cnt_emp
	FROM EMPLOYEES e
	JOIN DEPARTMENTS d ON e.DEPARTMENT_ID = d.DEPARTMENT_ID
	JOIN LOCATIONS l ON l.LOCATION_ID = d.LOCATION_ID
	JOIN COUNTRIES c ON c.COUNTRY_ID = l.COUNTRY_ID
	JOIN REGIONS r ON r.REGION_ID = c.REGION_ID
	GROUP BY REGION_NAME
	ORDER BY cnt_emp DESC) t1

--4.
SELECT DEPARTMENT_NAME, (1 -(AVG(SALARY) / (SELECT AVG(SALARY) FROM EMPLOYEES))) *100 AS diff_pct
FROM EMPLOYEES e
JOIN DEPARTMENTS d ON e.DEPARTMENT_ID = d.DEPARTMENT_ID
GROUP BY DEPARTMENT_NAME


--5.
SELECT FIRST_NAME, LAST_NAME 
FROM JOB_HISTORY j
JOIN EMPLOYEES e ON j.EMPLOYEE_ID = e.EMPLOYEE_ID 
WHERE DATEDIFF(YEAR, START_DATE, END_DATE) > 10

--6.
SELECT FIRST_NAME, LAST_NAME
FROM 
(SELECT FIRST_NAME, LAST_NAME, RANK() OVER(ORDER BY SALARY DESC) AS salary_rank
FROM EMPLOYEES) t1
WHERE salary_rank BETWEEN 5 AND 10
